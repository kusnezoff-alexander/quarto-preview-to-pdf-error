% Options for packages loaded elsewhere
% \PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[]{utils/nsm-thesis}
% \documentclass[
%   12pt,
%   letterpaper,
%   DIV=11,
%   numbers=noendperiod]{scrreprt}

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\makeatletter
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}{
    \@ifstar
      \xxxParagraphStar
      \xxxParagraphNoStar
  }
  \newcommand{\xxxParagraphStar}[1]{\oldparagraph*{#1}\mbox{}}
  \newcommand{\xxxParagraphNoStar}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}{
    \@ifstar
      \xxxSubParagraphStar
      \xxxSubParagraphNoStar
  }
  \newcommand{\xxxSubParagraphStar}[1]{\oldsubparagraph*{#1}\mbox{}}
  \newcommand{\xxxSubParagraphNoStar}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
\makeatother


\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother
% definitions for citeproc citations
\NewDocumentCommand\citeproctext{}{}
\NewDocumentCommand\citeproc{mm}{%
  \begingroup\def\citeproctext{#2}\cite{#1}\endgroup}
\makeatletter
 % allow citations to break across lines
 \let\@cite@ofmt\@firstofone
 % avoid brackets around text for \cite:
 \def\@biblabel#1{}
 \def\@cite#1#2{{#1\if@tempswa , #2\fi}}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[2] % #1 hanging-indent, #2 entry-spacing
 {\begin{list}{}{%
  \setlength{\itemindent}{0pt}
  \setlength{\leftmargin}{0pt}
  \setlength{\parsep}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
   \setlength{\leftmargin}{\cslhangindent}
   \setlength{\itemindent}{-1\cslhangindent}
  \fi
  % set entry spacing
  \setlength{\itemsep}{#2\baselineskip}}}
 {\end{list}}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{\hfill\break\parbox[t]{\linewidth}{\strut\ignorespaces#1\strut}}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

% Use fontspec to load Noto Emoji
\usepackage{fontspec}

% Define Noto Emoji font for emojis
\newfontfamily\emojiFont{Noto Emoji}
\newfontfamily\fallbackFont{DejaVu Sans}

% Automatically switch to emoji font for unicode emoji characters
\newcommand{\emoji}[1]{{\emojiFont #1}}
% Command for fallback font
\newcommand{\fallback}[1]{{\fallbackFont #1}}

\KOMAoption{captions}{tableheading}
\makeatletter
\@ifpackageloaded{bookmark}{}{\usepackage{bookmark}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother

\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={},
  pdfauthor={Alexander Kusnezoff},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

% \date{2025-01-01}

% Author name; separate multiple authors with commas.
\author{Alexander Kusnezoff}
\birthday{12.08.2003}
\birthplace{Dresden}

% Title of your thesis.
\title{mybook}

% Choose one of the following lines.
%\thesistype{Seminar Thesis}
%\thesistype{Bachelor Thesis}
%\thesistype{Master's Thesis}
%\thesistype{Diploma Thesis}
\thesistype{GroÃŸer Beleg}

% Choose one of the following lines or amend as necessary.
\degreeprogram{Computer Science}
%\degreeprogram{Computational Logic}
%\degreeprogram{Computational Modeling and Simulation}
%\degreeprogram{Distributed Systems Engineering}
%\degreeprogram{Information Systems Engineering}
%\degreeprogram{Media Informatics}

% List of advisors (without academic titles), separated by commas; comment out if not needed.
\advisors{Asif Ali Khan}

% List of referees (without academic titles), separated by commas.
\referees{Jeronimo Castrillon, Jane Doe}


\begin{document}
\maketitle

\renewcommand*\contentsname{Table of contents}
{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}

\bookmarksetup{startatroot}

\bookmarksetup{startatroot}

\chapter{}\label{section}

\bookmarksetup{startatroot}

\chapter{Extending the gem5 Simulator with support for PuD
Operations}\label{extending-the-gem5-simulator-with-support-for-pud-operations}

Memory Simulators allow for comparing different system configurations
and to easier control experimental conditions {[}1{]} with reasonable
effort before spending resources on an expensive hardware setup like
{[}2{]}.

Writing sth about matplotlib.. {[}3{]}

\href{../img/example.png}{my\_img}

\section{Introduction}\label{introduction}

This work does this and that by doing that and this \ldots{}

\bookmarksetup{startatroot}

\chapter{Background}\label{background}

\subsection{Overview of DRAMs}\label{overview-of-drams}

In order to understand how existing DRAM hardware can be used to not
only store data but also perform computations upon it, let us first have
a look at the internal workings of a DRAM.

{[}{[}ðŸ“™ðŸ’»DRAM\_Circuit\_Design\_Fundamental\_and\_High-Speed\_Topics{]}{]},
{[}{[}ðŸ§ ðŸ’»DRAM{]}{]}

\bookmarksetup{startatroot}

\chapter{PuD}\label{pud}

What is PuD? - ``Off-the-shelf DRAM chips are not officially designed to
support PuM operations (i.e., operations that are performed inside of a
memory)'' {[}4{]} - {[} {]} look at ðŸ§ ðŸ’»Processing\_using\_DRAM\_PuD

Why PuD: - Moore's Law and end of Dennard scaling motivated use of
``non-traditional media for computing'' {[}5{]} - ``reduce memory
consumption of data transfer between storage and processing units''
{[}5{]} - see ðŸ§ ðŸ’»Processing\_using\_DRAM\_PuD\#why-pud

Approaches: - modifying DRAM to ``to enable charge sharing between
rows'': RowClone, Ambit {[}5{]} - using ``unmodified, commodity, DRAM'':
by exploring how DRAM functions outside of the JEDEC specification
{[}5{]} - eg Compute-DRAM: realized with-memory computation by using ``y
using out-of-specification timed command sequences'' {[}5{]} - FracDRAM:
store fractional values inside COTS DRAMs {[}5{]} - set voltage-level
within capacitor at fine control (instead of just storing one or zero)
{[}5{]}

Before diving into how PuD works, we first need to understand how DRAMs
operate: - Note: ðŸ§ ðŸ’»DRAM\#DRAM Organization, Timing Constraints (JEDEC
Standard):
chip\textgreater bank\textgreater subarray\textgreater row\textgreater sense-amps\&cells,
ACT/PRE and timing inbtw

\subsubsection{Overview of Existing PuD
Approaches}\label{overview-of-existing-pud-approaches}

\ldots{} while SIMDRAM requires a data transposition unit to allow
transformation between horizontal data layout used by the CPU and
vertical data layout used by SIMDRAM {[}6{]} .

Another approach is to utilize commercially-off-the-shelft (COTS) DRAM
devices without any modifications for performing CIM-Operations {[}7{]}.

\subsubsection{Limitations of PuD}\label{limitations-of-pud}

\begin{itemize}
\item
  see
  {[}{[}ðŸ”¬ðŸ’»PuDHammer\_Experimental\_Analysis\_of\_Read\_Disturbance\_Effects\_of\_Processing-using-DRAM\_in\_Real\_DRAM\_Chips\_2025{]}{]}:
  RowClone (CoMRA) and Logic Ops (SiMRA)
\item
  low success rate: ``only a small fraction of DRAM columns can
  correctly execute PuM operations'' {[}4{]}

  \begin{itemize}
  \tightlist
  \item
    REASONS: ``operate beyond manufacturerrecommended timing
    constraints'' -\textgreater{} ``highly susceptible to noise and
    process variation'' {[}4{]}
  \end{itemize}
\item
  limited compute primitives: parallelism across DRAM can't be fully
  leveraged {[}4{]}
\end{itemize}

\subsubsection{COTS DRAMs}\label{cots-drams}

H8 module: - \texttt{2\^{}16} rows per bank: \texttt{2\^{}9} rows,
\texttt{2\^{}7} subarrays {[}4{]}

Typical row-size: 8KiB (=65536 32bit int elements?) {[}4{]}

\subsubsection{Operations Supported in
PuD}\label{operations-supported-in-pud}

=``basic buildings blocks for the target in-DRAM computation (e.g.,
addition, multiplication)'' {[}4{]}

\begin{itemize}
\item
  \texttt{AAP}=(inter-subarray) RowClone
\item
  Simultaneous Row Activation:

  \begin{itemize}
  \tightlist
  \item
    eg on SK Hynix: \texttt{ACT(8),PRE,ACT(1)} activates rows
    \texttt{0,1,8,9} {[}5{]}
  \end{itemize}
\item[$\square$]
  TRA (Ambit): implements MAJ3 {[}8{]}
\item
  INT ADD/SUB/MUL/DIV: via bit-serial computation (see SIMDRAM) {[}8{]}
\item
  increasing success rate for MAJ3: via input replication (=store
  multiple copies of each input on ALL simultaneously activated rows)
  {[}4{]}
\end{itemize}

\bookmarksetup{startatroot}

\chapter{Logic Synthesis and
Optimization}\label{logic-synthesis-and-optimization}

This other work is lit ngl\ldots{} {[}3{]}

\bookmarksetup{startatroot}

\chapter{OLD (FCDRAM-Topic)}\label{old-fcdram-topic}

\bookmarksetup{startatroot}

\chapter{gem5-CIM Architecture}\label{gem5-cim-architecture}

\section{Programming Model}\label{programming-model}

\includegraphics[width=0.5\linewidth,height=\textheight,keepaspectratio]{index_files/mediabag/diagram-1.pdf}

\begin{itemize}
\tightlist
\item
  \textbf{Memory Controller}: offers CIM Primitives for operations like
  addition, multiplication or logical operations and implements them by
  violating timing constraints specified in the DDR interface. These
  primitives are implemented via hard-coded Î¼Programs mapping those
  primitives to \texttt{AP}/\texttt{AAP} commands. @
\item
  \textbf{Operating System}: offers transparent mapping of virtual
  addresses to physical addresses
\item
  \textbf{ISA Extension}: additional CPU instructions that issue
  requests to the Memory Controller to perform the provided CIM
  primitives
\item
  \textbf{Device Driver}: CIM devices require special device drivers if
  treated as separate accelerators.
\end{itemize}

In the following discussion we focus on a system with a CIM-capable DRAM
module connected behind the Memory Controller. We assume that the
following information is available:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \emph{Address Mapping Scheme in Memory Controller}: For choosing the
  right physical addresses such that the row operands end up in the same
  bank and rank.
\item
  \emph{DRAM Subarray Topology}: For determining whether two rows in the
  same bank reside within the same subarray or in neighboring subarrays.
\end{enumerate}

The following features of modern computer systems are not addressed in
this simulator implementation: - {[} {]} \emph{IOMMU} (IO Memory
Management Unit): ``remaps addresses between a bus and main memory''
{[}9{]}

\section{Extending x86 ISA with CIM
Operations}\label{extending-x86-isa-with-cim-operations}

PIM Operations can be abstracted by the model of ``arbitrary bitwise
column operations in \(O(1)\) latency'' {[}10{]}

\begin{itemize}
\tightlist
\item[$\square$]
  ISA extension for CIM-ops (make Mem-Controller, or maybe device driver
  deal with the mapping to AAP/AP/..??)

  \begin{itemize}
  \tightlist
  \item[$\square$]
    or how else to propagate AP/AAP/APA/\ldots-primitives down the
    stack??
  \end{itemize}
\end{itemize}

The following operations are to be supported as CIM operations: -
\texttt{ROWAND},\texttt{ROWOR},\texttt{ROWXOR}: the row-operands are
expected to be placed in CPU registers (\texttt{Rsi}=dst-row,
\texttt{Rdi}=src-row 1, \texttt{Rdx}=src-row 2) - {[} {]}
\texttt{ROWNOT}:

which are performed using the following Primitives expected to be
provided by the Memory-Controller: - Ambit: \texttt{ROWAP},
\texttt{ROWAAP} - {[} {]} \ldots{}

: Overview of the proposed CIM ISA Extension {[}\^{}isa-opcode-note{]}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
Instruction Name & Opcode \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
ROWAND & 0x0F F2 C0 \\
ROWOR & 0x0F F2 C0 \\
ROWNOT & 0x0F F2 C0 \\
ROWXOR & 0x0F F2 C0 \\
ROWAP & 0x0F F2 C0 \\
ROWAAP & 0x0F F2 C0 \\
\end{longtable}

{[}\^{}isa-opcode-note{]} Note that the above opcode-mapping can easily
be changed without affecting the rest of gem5-CIM. The choice made here
is not absolute and might be adjusted by the ISA designers.

\subsection{Adding CIM Syscalls}\label{adding-cim-syscalls}

\begin{itemize}
\tightlist
\item[$\square$]
  \texttt{getCIMRegion()}: be aware of reserved memory regions eg for
  GDT (see \texttt{process.cc}:
  \texttt{allocateMem(\_gdtStart,\ \_gdtSize);})

  \begin{itemize}
  \tightlist
  \item[$\square$]
    TODO: make sure returned physical address range is NOT mapped into
    any other process
  \end{itemize}
\end{itemize}

\section{Combining CIM with Out-of-Order
Execution}\label{combining-cim-with-out-of-order-execution}

Involved Components (focus on Out-of-Order Execution) -
{[}{[}ðŸ§ ðŸ’»Load\_Store\_Unit\_LSU{]}{]} -
{[}{[}ðŸ§ ðŸ’»Re-Order\_Buffer\_ROB{]}{]} - Register Renaming, \ldots{}

\section{Adding CIM Functionality to gem5
25.0}\label{adding-cim-functionality-to-gem5-25.0}

\subsection{Portability Issues}\label{portability-issues}

Opcodes used in MIMDRAM (taken from
\texttt{x86/isa/decoder/two\_bytes\_opcodes.isa}): - {[} {]} !!!! check
gem5 op-encoding (to not accidentally set register-bits by opcode !!!)

Flag chosen in MIMDRAM for \texttt{ROWOP=0x40000000} (see
\href{https://github.com/CMU-SAFARI/MIMDRAM/blob/23495f10950d891a95a0b8a05d0a6a88e92de154/gem5/src/mem/request.hh\#L173}{MIMDRAM})
was already taken in new version of gem5: -
\texttt{ATOMIC\_RETURN\_OP=0x40000000,}
\href{https://github.com/gem5/gem5/blob/ddd4ae35adb0a3df1f1ba11e9a973a5c2f8c2944/src/mem/request.hh\#L175}{gem5:
request.hh}

so I had to carefully choose another free value which I chose to be:
\texttt{ROWOP\ =\ 0x100000000} (=2\^{}32)

Minor Code Changes:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{// in mem/request.hh :}
\OperatorTok{{-}{-}}\NormalTok{ req\_dest }\OperatorTok{=}\NormalTok{ new Request}\OperatorTok{(*}\NormalTok{this}\OperatorTok{);}
\OperatorTok{++}\NormalTok{ req\_dest }\OperatorTok{=}\NormalTok{ std}\OperatorTok{::}\NormalTok{make\_shared}\OperatorTok{\textless{}}\NormalTok{Request}\OperatorTok{\textgreater{}(*}\NormalTok{this}\OperatorTok{);}

\CommentTok{// cpu/simple/timing.cc :}
\OperatorTok{{-}{-}}\NormalTok{ thread}\OperatorTok{{-}\textgreater{}}\NormalTok{dtb}\OperatorTok{{-}\textgreater{}}\NormalTok{translateTiming}\OperatorTok{(}\NormalTok{req\_src2}\OperatorTok{,}\NormalTok{ tc}\OperatorTok{,}\NormalTok{ trans3}\OperatorTok{,}\NormalTok{ mode}\OperatorTok{);}
\OperatorTok{++}\NormalTok{ thread}\OperatorTok{{-}\textgreater{}}\NormalTok{mmu}\OperatorTok{{-}\textgreater{}}\NormalTok{translateTiming}\OperatorTok{(}\NormalTok{req\_src2}\OperatorTok{,}\NormalTok{ thread}\OperatorTok{{-}\textgreater{}}\NormalTok{getTC}\OperatorTok{(),}\NormalTok{ trans3}\OperatorTok{,}\NormalTok{ mode}\OperatorTok{);}
\OperatorTok{\textless{}}\NormalTok{TODO}\OperatorTok{..\textgreater{}}

\CommentTok{// cpu/translation.hh :}
\OperatorTok{\textless{}}\NormalTok{TODO}\OperatorTok{..\textgreater{}}
\end{Highlighting}
\end{Shaded}

\bookmarksetup{startatroot}

\chapter{Software Architecture}\label{software-architecture}

\section{Programming Model}\label{programming-model-1}

\begin{itemize}
\tightlist
\item
  CIM uses separate address space (to avoid structural hazard of shared
  I/O Resources, eg by CPU/GPU) {[}11{]}

  \begin{itemize}
  \tightlist
  \item
    eg upmem: 1) allocate data on DRAM, 2) copy data to PIM address
    space {[}11{]}
  \end{itemize}
\end{itemize}

\section{Address Translation}\label{address-translation}

As explained in Chapter 2, PuD operations require precise control of the
data placement within corresponding banks, ranks and even subarrays.
Since processes use virtual address spaces understanding the Address
Translation towards physical addresses is crucial.

The example below illustrates how this address translation works given
some virtual addresses for the address mapping schemes
\texttt{RoRaBaChCo}, \texttt{RoRaBaCoCh} and \texttt{RoCoRaBaCh}
implemented in gem5. The variables \texttt{dst}, \texttt{src1},
\texttt{src2} denote virtual addresses pointing to rows in the DRAM
which hold the corresponding operand data. We chose to allocate a
dedicated virtual address space region per process that is reserved for
CIM row operands similar to existing CIM Software Stacks.

Note that addresses used for CIM are marked as uncacheable and hence are
invoke a pagetable walk after causing a TLB miss

\textless{} REMINDER of virtual address translation flow through
MMU-\textgreater TLB lookup -\textgreater{} Page Table Walk (on miss)
-\textgreater{} Update TLB -\textgreater{} Physical address

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# 1. Virtual Addresses are translated to physical addresses}
\ExtensionTok{dst}\NormalTok{ = 0x9567890}
\ExtensionTok{src1}\NormalTok{ =}

\CommentTok{\#  \textasciigrave{}RoRaBaChCo\textasciigrave{} and \textasciigrave{}RoRaBaCoCh\textasciigrave{} work the same}
\end{Highlighting}
\end{Shaded}

The allocation of dedicated CIM address spaces is achieved by utilizing
a device driver that manages the memory address space rather than
relying on OS support via additional syscalls like \texttt{pim\_alloc()}
used in MIMDRAM {[}12{]}. We image the programming model to work like
detailed in the following C code example:

\begin{codelisting}

\centering{

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{\#include }\ImportTok{\textless{}stdio.h\textgreater{}}
\PreprocessorTok{\#include }\ImportTok{\textless{}stdlib.h\textgreater{}}
\PreprocessorTok{\#include }\ImportTok{\textless{}fcntl.h\textgreater{}}
\PreprocessorTok{\#include }\ImportTok{\textless{}sys/mman.h\textgreater{}}
\PreprocessorTok{\#include }\ImportTok{\textless{}unistd.h\textgreater{}}
\PreprocessorTok{\#include }\ImportTok{\textless{}errno.h\textgreater{}}
\PreprocessorTok{\#include }\ImportTok{\textless{}string.h\textgreater{}}

\DataTypeTok{int}\NormalTok{ main}\OperatorTok{()} \OperatorTok{\{}
    \DataTypeTok{const} \DataTypeTok{char} \OperatorTok{*}\NormalTok{path }\OperatorTok{=} \StringTok{"/dev/cim"}\OperatorTok{;}
    \DataTypeTok{size\_t}\NormalTok{ length }\OperatorTok{=} \DecValTok{8} \OperatorTok{*} \DecValTok{1024} \OperatorTok{*} \DecValTok{1024}\OperatorTok{;} \CommentTok{// 8 MB}

    \DataTypeTok{int}\NormalTok{ fd }\OperatorTok{=}\NormalTok{ open}\OperatorTok{(}\NormalTok{path}\OperatorTok{,}\NormalTok{ O\_RDWR}\OperatorTok{);}
    \ControlFlowTok{if} \OperatorTok{(}\NormalTok{fd }\OperatorTok{\textless{}} \DecValTok{0}\OperatorTok{)} \OperatorTok{\{}
\NormalTok{        perror}\OperatorTok{(}\StringTok{"open failed"}\OperatorTok{);}
        \ControlFlowTok{return} \DecValTok{1}\OperatorTok{;}
    \OperatorTok{\}}

    \DataTypeTok{void} \OperatorTok{*}\NormalTok{addr }\OperatorTok{=}\NormalTok{ mmap}\OperatorTok{(}\NormalTok{NULL}\OperatorTok{,}\NormalTok{ length}\OperatorTok{,}\NormalTok{ PROT\_READ }\OperatorTok{|}\NormalTok{ PROT\_WRITE}\OperatorTok{,}\NormalTok{ MAP\_SHARED}\OperatorTok{,}\NormalTok{ fd}\OperatorTok{,} \DecValTok{0}\OperatorTok{);}
    \ControlFlowTok{if} \OperatorTok{(}\NormalTok{addr }\OperatorTok{==}\NormalTok{ MAP\_FAILED}\OperatorTok{)} \OperatorTok{\{}
\NormalTok{        perror}\OperatorTok{(}\StringTok{"mmap failed"}\OperatorTok{);}
\NormalTok{        close}\OperatorTok{(}\NormalTok{fd}\OperatorTok{);}
        \ControlFlowTok{return} \DecValTok{2}\OperatorTok{;}
    \OperatorTok{\}}

    \CommentTok{// Example usage: write first byte}
    \OperatorTok{((}\DataTypeTok{char}\OperatorTok{*)}\NormalTok{addr}\OperatorTok{)[}\DecValTok{0}\OperatorTok{]} \OperatorTok{=} \DecValTok{42}\OperatorTok{;}

    \CommentTok{// Clean up}
\NormalTok{    munmap}\OperatorTok{(}\NormalTok{addr}\OperatorTok{,}\NormalTok{ length}\OperatorTok{);}
\NormalTok{    close}\OperatorTok{(}\NormalTok{fd}\OperatorTok{);}
    \ControlFlowTok{return} \DecValTok{0}\OperatorTok{;}
\OperatorTok{\}}
\end{Highlighting}
\end{Shaded}

}

\caption{\label{lst-customers}Mapping CIM-Regions into a Process'
address space}

\end{codelisting}%

Virtual Address Translation remains an unsolved problem which we decided
to postpone to further work which might also explore the implementation
of ``The Virtual Block Interface: A Flexible Alternative to the
Conventional Virtual Memory Framework'' (2020) into the simulator.

\subsection{Translation Schemes}\label{translation-schemes}

\begin{itemize}
\tightlist
\item[$\square$]
  CIM transparent to the user (everythin is handled by the MC)
\item[$\square$]
  CIM as separate accelerators
\end{itemize}

Still what remains transparent to the Memory Controller is the mapping
to subarrays which is crucial since most CIM operations only work for
rows within the same subarray. TODO: describe how we deal with this
restriction

\begin{figure}

\centering{

\includegraphics[width=15.17in,height=0.73in]{content/03_01_gem5_Software_files/figure-latex/mermaid-figure-1.png}

}

\caption{\label{fig-addr-translation}Traditional Address Translation in
Computer Systems (TLB omitted for simplicity)}

\end{figure}%

Several approaches can be taken to achieve this data placement which are
discussed below, all of which require substantial modifications to the
System to fully support capabilities of this emerging technology.

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\tightlist
\item
  \textbf{Application-level control}: The underlying system provides the
  application with a \emph{raw} memory region giving it direct access to
  the DRAM device without intermediate address translations (see
  \textbf{fig?}). This allows the data placement to be made during
  compilation enabling CIM as an optional optimization fixed at
  compile-time.
\end{enumerate}

\begin{figure}

\centering{

\includegraphics[width=15.67in,height=0.73in]{content/03_01_gem5_Software_files/figure-latex/mermaid-figure-3.png}

}

\caption{\label{fig-addr-translation-application-level}Proposed
Application-level Address Translation CIM Support (TLB omitted for
simplicity)}

\end{figure}%

It has to be noted that this approach allows applications to directly
access hardware devices, like the DRAM in this example, posing potential
security risks where a process could access private data of another
process that would otherwise be safe in its virtual address space.
Likewise the OS would have to mark that address-range so that it is not
reused by other processes which could overwrite intermediate values.

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{1}
\tightlist
\item
  \textbf{OS-level control}: In this approach the Operating System still
  manages the Page Table and thereby takes care of mapping virtual
  addresses to physical addresses. In order for this mapping to be
  PIM-compatible the OS needs to know which row operands depend on each
  other in order to place them in the correct rank, bank and row. To
  pass this information over additional syscalls would be required as
  shown in \textbf{fig?}, where the \texttt{row\_group} parameter makes
  sure that all row-operands within the same \texttt{row\_group} do end
  up in the same bank (or even subarray, depending on the CIM
  technology).
\end{enumerate}

\begin{figure}

\centering{

\includegraphics[width=5.1in,height=0.24in]{content/03_01_gem5_Software_files/figure-latex/mermaid-figure-2.png}

}

\caption{\label{fig-addr-translation-os-level}Proposed OS-level Address
Translation CIM Support (TLB omitted for simplicity)}

\end{figure}%

--\textgreater{}

\textbf{PIM Driver}: {[}13{]}

\bookmarksetup{startatroot}

\chapter{Experimental Setup}\label{experimental-setup}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\linewidth - 2\tabcolsep) * \real{0.1765}}
  >{\raggedright\arraybackslash}p{(\linewidth - 2\tabcolsep) * \real{0.8235}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Module
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Configuration
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Module
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Configuration
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\tabularnewline
\caption{System Configuration. (TODO: check!)}\tabularnewline
\endlastfoot
Core & 5-wide fetch, 5-wide decode \\
\end{longtable}

\begin{verbatim}
                  10-wide issue, 10-wide commit
                  120-entry IQ, 85/90-entry LQ/SQ
                  288-entry ROB                                                                                      |
\end{verbatim}

Private L1 I/D cache\textbar{} 64 KB each, 4-way, 64B line, 16 MSHRs
PLRU, 2 cycles hit latency degree-8 stride prefetcher for L1D cache
\textbar{}\\
Private L2 cache \textbar{} 512 KB, 8-way, 64B line, 32 MSHRs PLRU,
mostly\_inclusive 9 cycles hit latency \textbar{}\\
Shared L3 cache \textbar{} 2 MB/core, 16-way, 64B line, 36 MSHRs CHAR
{[}18{]}, mostly\_exclusive 20 cycles hit latency \textbar{}\\
Memory \textbar{} LPDDR5\_5500\_1x16\_BG\_BL32 Single channel, 1 rank
per channel \textbar{}

System Configuration. We evaluate Prophet using gem5's FS mode {[}14{]}.
We utilize facilities within gem5 to collect counters.

gem5 Configuration commands:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# MIMDRAM (\textasciigrave{}DDR4\_2400\_x86\textasciigrave{} used here is a 8x8 one, see \textasciigrave{}MIMDRAM/gem5/src/mem/DRAMCtrl.py\textasciigrave{})}
\ExtensionTok{./build/X86/gem5.opt}\NormalTok{ configs/example/se.py }\AttributeTok{{-}{-}cpu{-}type}\OperatorTok{=}\NormalTok{detailed }\AttributeTok{{-}{-}caches} \AttributeTok{{-}{-}l2cache} \AttributeTok{{-}{-}mem{-}type}\OperatorTok{=}\NormalTok{DDR4\_2400\_x64 }\AttributeTok{{-}{-}mem{-}size}\OperatorTok{=}\NormalTok{8192MB }\AttributeTok{{-}c}\NormalTok{ /MIMDRAM/microworkloads/bitweave{-}baseline.exe  }\AttributeTok{{-}o} \StringTok{"10 1"}

\CommentTok{\# gem5{-}CIM (}\AlertTok{NOTE}\CommentTok{: \textasciigrave{}MIMDRAM/gem5/configs/common/CpuConfig.py\textasciigrave{} specifies \textasciigrave{}detailed\textasciigrave{} as alias for \textasciigrave{}DerivO3CPU\textasciigrave{})}
\ExtensionTok{./build/X86/gem5.debug}\NormalTok{ configs/deprecated/example/se.py }\AttributeTok{{-}{-}cpu{-}type}\OperatorTok{=}\NormalTok{DerivO3CPU }\AttributeTok{{-}{-}caches} \AttributeTok{{-}{-}l2cache} \AttributeTok{{-}{-}mem{-}type}\OperatorTok{=}\NormalTok{DDR4\_2400\_8x8 }\AttributeTok{{-}{-}mem{-}size}\OperatorTok{=}\NormalTok{8192MB }\AttributeTok{{-}c}\NormalTok{ ../microworkloads/bitweave{-}baseline.exe  }\AttributeTok{{-}o} \StringTok{"10 1"}
\end{Highlighting}
\end{Shaded}

\section{Evaluation}\label{evaluation}

--\textgreater{}

\subsection{Limitations}\label{limitations}

\section{Comparison}\label{comparison}

\begin{longtable}[]{@{}llll@{}}
\toprule\noalign{}
& gem5-CIM & MIMDRAM & \ldots{} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Supports & âœ“ & X & \ldots{} \\
\end{longtable}

\begin{itemize}
\tightlist
\item[$\square$]
  MIMDRAM: see \texttt{AbstractMemory:acces()}: doesnt support
  ROWAP\&ROWAAP !! (they're still marked as TODOs!)
\item[$\square$]
  MIMDRAM's gem5 version: didn't have \texttt{byteEnable} - How did they
  do it instead? (or what is it used for in general? Is functionality
  missing in that old gem5 version?)
\end{itemize}

\bookmarksetup{startatroot}

\chapter{Acknowledgments}\label{acknowledgments}

\bookmarksetup{startatroot}

\chapter{Conclusion}\label{conclusion}

We verified our initial hypothesis \ldots{} or maybe we didn't, who
knows.

\bookmarksetup{startatroot}

\chapter{References}\label{references}

\phantomsection\label{refs}
\begin{CSLReferences}{0}{0}
\bibitem[\citeproctext]{ref-S6934PCB}
\CSLLeftMargin{{[}1{]} }%
\CSLRightInline{{``Simulation modeling and analysis (mcgraw-hill series
in industrial engineering and management): Law, averill m.:
9780073401324: Amazon.com: books.''} Accessed: Jan. 29, 2025.
{[}Online{]}. Available:
\url{https://www.amazon.com/Simulation-Mcgraw-hill-Industrial-Engineering-Management/dp/0073401323}}

\bibitem[\citeproctext]{ref-HGPJV4HG}
\CSLLeftMargin{{[}2{]} }%
\CSLRightInline{A. Olgun \emph{et al.}, {``DRAM bender: An extensible
and versatile FPGA-based infrastructure to easily test state-of-the-art
DRAM chips,''} \emph{IEEE Transactions on Computer-Aided Design of
Integrated Circuits and Systems}, vol. 42, no. 12, pp. 5098--5112, Dec.
2023, doi:
\href{https://doi.org/10.1109/TCAD.2023.3282172}{10.1109/TCAD.2023.3282172}.}

\bibitem[\citeproctext]{ref-YGQM93JE}
\CSLLeftMargin{{[}3{]} }%
\CSLRightInline{{``Using matplotlib --- matplotlib 3.10.1
documentation.''} Accessed: Mar. 26, 2025. {[}Online{]}. Available:
\url{https://matplotlib.org/stable/users/index.html}}

\bibitem[\citeproctext]{ref-PWJ78PUP}
\CSLLeftMargin{{[}4{]} }%
\CSLRightInline{I. E. Yuksel \emph{et al.}, {``PULSAR: Simultaneous
many-row activation for reliable and high-performance computing in
off-the-shelf DRAM chips.''} Mar. 18, 2024. doi:
\href{https://doi.org/10.48550/arXiv.2312.02880}{10.48550/arXiv.2312.02880}.}

\bibitem[\citeproctext]{ref-ALALYMIB}
\CSLLeftMargin{{[}5{]} }%
\CSLRightInline{F. Gao, G. Tziantzioulis, and D. Wentzlaff, {``FracDRAM:
Fractional values in off-the-shelf DRAM,''} in \emph{2022 55th IEEE/ACM
international symposium on microarchitecture (MICRO)}, Oct. 2022, pp.
885--899. doi:
\href{https://doi.org/10.1109/MICRO56248.2022.00066}{10.1109/MICRO56248.2022.00066}.}

\bibitem[\citeproctext]{ref-9BWHUC8U}
\CSLLeftMargin{{[}6{]} }%
\CSLRightInline{{``SIMDRAM: A framework for bit-serial SIMD processing
using DRAM \textbar{} proceedings of the 26th ACM international
conference on architectural support for programming languages and
operating systems.''} Accessed: Apr. 12, 2025. {[}Online{]}. Available:
\url{https://dl.acm.org/doi/abs/10.1145/3445814.3446749}}

\bibitem[\citeproctext]{ref-X5J6YXMD}
\CSLLeftMargin{{[}7{]} }%
\CSLRightInline{Ä°. E. YÃ¼ksel \emph{et al.}, {``Functionally-complete
boolean logic in real DRAM chips: Experimental characterization and
analysis,''} in \emph{2024 IEEE international symposium on
high-performance computer architecture (HPCA)}, Mar. 2024, pp. 280--296.
doi:
\href{https://doi.org/10.1109/HPCA57654.2024.00030}{10.1109/HPCA57654.2024.00030}.}

\bibitem[\citeproctext]{ref-LKPK9TGV}
\CSLLeftMargin{{[}8{]} }%
\CSLRightInline{H. Shin, R. Park, and J. W. Lee, {``A
processing-using-memory architecture for commodity DRAM devices with
enhanced compatibility and reliability,''} in \emph{Proceedings of the
43rd IEEE/ACM international conference on computer-aided design}, in
ICCAD '24. New York, NY, USA: Association for Computing Machinery, Apr.
2025, pp. 1--10. doi:
\href{https://doi.org/10.1145/3676536.3676771}{10.1145/3676536.3676771}.}

\bibitem[\citeproctext]{ref-SYDWNKQ2}
\CSLLeftMargin{{[}9{]} }%
\CSLRightInline{\emph{Linux device drivers, 3rd edition}. Accessed: Nov.
06, 2025. {[}Online{]}. Available:
\url{https://learning.oreilly.com/library/view/linux-device-drivers/0596005903/}}

\bibitem[\citeproctext]{ref-5GARQAKX}
\CSLLeftMargin{{[}10{]} }%
\CSLRightInline{O. Leitersdorf, D. Leitersdorf, J. Gal, M. Dahan, R.
Ronen, and S. Kvatinsky, {``AritPIM: High-throughput in-memory
arithmetic,''} \emph{IEEE Transactions on Emerging Topics in Computing},
vol. 11, no. 3, pp. 720--735, Jul. 2023, doi:
\href{https://doi.org/10.1109/TETC.2023.3268137}{10.1109/TETC.2023.3268137}.}

\bibitem[\citeproctext]{ref-EAV4GJD6}
\CSLLeftMargin{{[}11{]} }%
\CSLRightInline{D. Lee, B. Hyun, T. Kim, and M. Rhu, {``PIM-MMU: A
memory management unit for accelerating data transfers in commercial PIM
systems,''} in \emph{2024 57th IEEE/ACM international symposium on
microarchitecture (MICRO)}, Nov. 2024, pp. 627--642. doi:
\href{https://doi.org/10.1109/MICRO61859.2024.00053}{10.1109/MICRO61859.2024.00053}.}

\bibitem[\citeproctext]{ref-YIUYW7TC}
\CSLLeftMargin{{[}12{]} }%
\CSLRightInline{G. F. Oliveira \emph{et al.}, {``MIMDRAM: An end-to-end
processing-using-DRAM system for high-throughput, energy-efficient and
programmer-transparent multiple-instruction multiple-data computing,''}
in \emph{2024 IEEE international symposium on high-performance computer
architecture (HPCA)}, Mar. 2024, pp. 186--203. doi:
\href{https://doi.org/10.1109/HPCA57654.2024.00024}{10.1109/HPCA57654.2024.00024}.}

\bibitem[\citeproctext]{ref-5BZXW8H2}
\CSLLeftMargin{{[}13{]} }%
\CSLRightInline{S. Lee \emph{et al.}, {``Hardware architecture and
software stack for PIM based on commercial DRAM technology : Industrial
product,''} in \emph{2021 ACM/IEEE 48th annual international symposium
on computer architecture (ISCA)}, Jun. 2021, pp. 43--56. doi:
\href{https://doi.org/10.1109/ISCA52012.2021.00013}{10.1109/ISCA52012.2021.00013}.}

\end{CSLReferences}

\bookmarksetup{startatroot}

\chapter{}\label{section-1}

\begin{itemize}
\tightlist
\item
  PuD=Processing using DRAM
\item
  MMU=Memory Management Unit
\item
  OS=Operating System
\item
  TLB=Translation Lookaside Buffer
\item
  DRAM=Dynamic Random Access Memory
\item
  PIM=Processing-in-Memory
\item
  CIM=Computing-in-Memory
\item
  COTS=commercially of-the-shelf
\end{itemize}

\end{document}
